<!DOCTYPE html>
<html class="writer-html5" lang="English" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyraa.simulation &mdash; PyRAA 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> PyRAA
            <img src="../../_static/pyraa_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">PyRAA Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowldegments.html">PyRAA Acknowlegements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyRAA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>pyraa.simulation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyraa.simulation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    simulation module ``simulation.py`` </span>
<span class="sd">    </span>
<span class="sd">    Base class of PyRAA</span>

<span class="sd">    :Authors: Drew Langford</span>

<span class="sd">    :Last Edit: </span>
<span class="sd">        Langford, 06/2022</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Standard packages</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">functools</span> <span class="k">as</span> <span class="nn">ft</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Third-Party packages</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">sci_sp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">progressbar</span>
<span class="kn">from</span> <span class="nn">pygame</span> <span class="kn">import</span> <span class="n">mixer</span>

<span class="c1"># PyRAA modules</span>
<span class="kn">from</span> <span class="nn">pyraa.models</span> <span class="kn">import</span> <span class="n">Models</span>
<span class="kn">from</span> <span class="nn">pyraa.satellite</span> <span class="kn">import</span> <span class="n">Satellite</span>
<span class="kn">import</span> <span class="nn">pyraa.dyn_sys_tools</span> <span class="k">as</span> <span class="nn">tools</span>


<span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYGAME_HIDE_SUPPORT_PROMPT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<span class="n">sys_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Earth-Moon&#39;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;m1&#39;</span> <span class="p">:</span> <span class="mf">5.97e24</span><span class="p">,</span>
        <span class="s1">&#39;m2&#39;</span> <span class="p">:</span> <span class="mf">0.073e24</span><span class="p">,</span>
        <span class="s1">&#39;mu&#39;</span> <span class="p">:</span> <span class="mf">0.0121505856</span><span class="p">,</span>
        <span class="s1">&#39;e&#39;</span> <span class="p">:</span> <span class="mf">0.0549</span><span class="p">,</span>
        <span class="s1">&#39;l_st&#39;</span> <span class="p">:</span> <span class="mi">384748</span><span class="p">,</span>
        <span class="s1">&#39;t_st&#39;</span> <span class="p">:</span> <span class="mi">375700</span><span class="p">,</span>
        <span class="s1">&#39;m_st&#39;</span> <span class="p">:</span> <span class="mf">5.97e24</span> <span class="o">+</span> <span class="mf">0.073e24</span><span class="p">,</span>
        <span class="s1">&#39;p1_c&#39;</span> <span class="p">:</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;p2_c&#39;</span> <span class="p">:</span> <span class="s1">&#39;dimgray&#39;</span>
    <span class="p">},</span>

    <span class="s1">&#39;EarthMoonSun&#39;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;m1&#39;</span> <span class="p">:</span> <span class="mf">5.97e24</span><span class="p">,</span>
        <span class="s1">&#39;m2&#39;</span> <span class="p">:</span> <span class="mf">0.073e24</span><span class="p">,</span>
        <span class="s1">&#39;m3&#39;</span> <span class="p">:</span> <span class="mf">1.989e30</span><span class="p">,</span>
        <span class="s1">&#39;mu&#39;</span> <span class="p">:</span> <span class="mf">0.0121505856</span><span class="p">,</span>
        <span class="s1">&#39;e&#39;</span> <span class="p">:</span> <span class="mf">0.0549</span><span class="p">,</span>
        <span class="s1">&#39;l_st&#39;</span> <span class="p">:</span> <span class="mi">384748</span><span class="p">,</span>
        <span class="s1">&#39;t_st&#39;</span> <span class="p">:</span> <span class="mi">375700</span><span class="p">,</span>
        <span class="s1">&#39;a_s&#39;</span> <span class="p">:</span> <span class="mi">149600000</span><span class="o">/</span><span class="mi">384748</span><span class="p">,</span>
        <span class="s1">&#39;m_s&#39;</span> <span class="p">:</span> <span class="mf">1.989e30</span><span class="o">/</span><span class="p">(</span><span class="mf">5.97e24</span> <span class="o">+</span> <span class="mf">0.073e24</span><span class="p">)</span>
    <span class="p">},</span>

    <span class="s1">&#39;Kepler-34&#39;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;m1&#39;</span> <span class="p">:</span> <span class="mf">1.0479</span><span class="p">,</span>
        <span class="s1">&#39;m2&#39;</span> <span class="p">:</span> <span class="mf">1.0208</span><span class="p">,</span>
        <span class="s1">&#39;mu&#39;</span> <span class="p">:</span> <span class="mf">0.4934</span><span class="p">,</span>
        <span class="s1">&#39;e&#39;</span> <span class="p">:</span> <span class="mf">0.52087</span><span class="p">,</span>
        <span class="s1">&#39;t_st&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;l_st&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;m_st&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;p1_c&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;p2_c&#39;</span> <span class="p">:</span> <span class="kc">None</span>
    <span class="p">}</span>
<span class="p">}</span>

<div class="viewcode-block" id="Simulation"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation">[docs]</a><span class="k">class</span> <span class="nc">Simulation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulation -- base class of PyRAA</span>

<span class="sd">    The ``Simulation`` class contains the core functionality including </span>

<span class="sd">    * satellite object creation</span>
<span class="sd">    * EOM propogation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dynamics: str </span>
<span class="sd">        dynamical model of the simulated enviroment</span>
<span class="sd">        </span>
<span class="sd">        Options: [&#39;CR3BP&#39;, &#39;ER3BP&#39;, &#39;BCR4BP&#39;, &#39;BER4BP&#39;]</span>

<span class="sd">    mu: float</span>
<span class="sd">        mass ratio of system</span>
<span class="sd">    e: float</span>
<span class="sd">        eccentricity of system</span>
<span class="sd">    system: dict</span>
<span class="sd">        pre-set values of a system</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dynamics</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.012</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">system</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">intro</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Simulation class:</span>
<span class="sd">                Initialize a simulations enviroment with specified dynamics</span>

<span class="sd">                    Args:</span>
<span class="sd">                        dynamics (str): dynamical model of the simulated enviroment</span>
<span class="sd">                            Options: [&#39;CR3BP&#39;, &#39;ER3BP&#39;, &#39;BCR4BP&#39;, &#39;BER4BP&#39;]</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">intro</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;intro_music.mp3&#39;</span>
            <span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span> <span class="o">=</span> <span class="s1">&#39;darkorange&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span> <span class="o">=</span> <span class="s1">&#39;orangered&#39;</span>
        
        <span class="k">if</span> <span class="n">system</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sys_name</span> <span class="o">=</span> <span class="n">system</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;System not found...&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_st</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;t_st&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;l_st&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">m_st</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;m_st&#39;</span><span class="p">]</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;p1_c&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span> <span class="o">=</span> <span class="n">sys_dict</span><span class="p">[</span><span class="n">system</span><span class="p">][</span><span class="s1">&#39;p2_c&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_st</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_st</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">### Assign dynamical model attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">=</span> <span class="n">dynamics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eom_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eom_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jacobian_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_jacobian_func</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_pstates_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_Lstates_func</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">JC_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_JC_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_transform_func</span><span class="p">()</span>


        <span class="c1"># Initialize an empty list of sc objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sats</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Loose ends </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;z&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;xdot&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> 
            <span class="s1">&#39;ydot&#39;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;zdot&#39;</span> <span class="p">:</span> <span class="mi">5</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cividis&#39;</span> <span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">cividis</span><span class="p">,</span>
            <span class="s1">&#39;viridis&#39;</span> <span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span>
            <span class="s1">&#39;jet&#39;</span> <span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
            <span class="s1">&#39;plasma&#39;</span> <span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inert_prop_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prim_prop_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Js</span> <span class="o">=</span> <span class="n">sci_sp</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Js</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">intro</span><span class="p">:</span>
            <span class="c1"># Welcome message</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="c1"># print(30*&#39; &#39;, &#39;WELCOME TO PyRAA&#39;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WELCOME TO PyRAA&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Python Restricted Astronomy and Astrodynamics&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Developer: Drew Langford&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Contact: langfora@purdue.edu&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="n">logo_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;RA_logo.txt&quot;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">logo_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">logo_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Simulation initialized.&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_sim_state</span><span class="p">()</span>
        
        <span class="k">pass</span>

<div class="viewcode-block" id="Simulation.print_sim_state"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.print_sim_state">[docs]</a>    <span class="k">def</span> <span class="nf">print_sim_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        print_sim_state - prints state of simulation object</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation Overview &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;System:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_name</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Dynamics:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Mass Ratio (mu):&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Eccentricity:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Number of sc:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Characteristic Mass [kg]:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">m_st</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Characteristic Length [km]:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}{</span><span class="s1">&#39;Characteristic Time [s]:&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">t_st</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.create_sat"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.create_sat">[docs]</a>    <span class="k">def</span> <span class="nf">create_sat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s0</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create_sc - creates new satellite object with initial state and epoch</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s0: 1x6 array</span>
<span class="sd">            initial non-dim state vector of sc</span>
<span class="sd">        tau_0: float</span>
<span class="sd">            initial non-dim epoch of sc</span>
<span class="sd">        color: str or tuple</span>
<span class="sd">            color of plotted sc</span>
<span class="sd">        alpha: float</span>
<span class="sd">            tranparency of plotted sc</span>
<span class="sd">        verbose: bool</span>
<span class="sd">            if true, prints new sc message</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sc: class obj</span>
<span class="sd">            sc object instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize a satellite object</span>

        <span class="c1"># if color == None:</span>
        <span class="c1">#     color = &#39;firebrick&#39;</span>
        <span class="n">sat</span> <span class="o">=</span> <span class="n">Satellite</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
        
        <span class="c1"># Add to scs list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New satellite created..&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total satellite: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">sat</span></div>

<div class="viewcode-block" id="Simulation.load_sc"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.load_sc">[docs]</a>    <span class="k">def</span> <span class="nf">load_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">taus</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        load_sc - loads saved states into memory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        states: Nx6 array</span>

<span class="sd">        taus: 1xN array</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">s0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span>

        <span class="n">sc</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">states</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">taus</span> <span class="o">=</span> <span class="n">taus</span></div>



    <span class="k">def</span> <span class="nf">ydotconst_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">jc</span><span class="p">):</span>

        <span class="c1"># x, y, z, xdot, ydot, zdot = s</span>
        <span class="c1"># e_state, m_state = self.model.cr3bp_pstates(tau)</span>

        <span class="c1"># r13 = np.linalg.norm(s[0:3] - e_state[0:3])</span>
        <span class="c1"># r23 = np.linalg.norm(s[0:3] - m_state[0:3])</span>

        <span class="n">Ust</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ydot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ust</span> <span class="o">-</span> <span class="n">jc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ydot</span>

<div class="viewcode-block" id="Simulation.ydot_griddist"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.ydot_griddist">[docs]</a>    <span class="k">def</span> <span class="nf">ydot_griddist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xdot</span><span class="p">,</span> <span class="n">JC</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ydot_griddits - returns ydot values for </span>
<span class="sd">            a given x, xdot, JC on the x-axis</span>

<span class="sd">            Used for grid distributions</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Vtot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vtot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JC</span><span class="p">)</span>
        <span class="n">Vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Vtot</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">xdot</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Vy</span></div>


    <span class="k">def</span> <span class="nf">Vtot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">JC</span><span class="p">):</span>
        
        <span class="n">Ust</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">))</span>
        
        <span class="n">Vtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ust</span> <span class="o">-</span> <span class="n">JC</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Vtot</span>

<div class="viewcode-block" id="Simulation.Vxy_raddist"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.Vxy_raddist">[docs]</a>    <span class="k">def</span> <span class="nf">Vxy_raddist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">rand_v</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            xy_raddist - returns a radial distribution of </span>
<span class="sd">                x and y velocities for a given x and JC on the </span>
<span class="sd">                x axis/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">rand_v</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vtot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JC</span><span class="p">)</span>

        <span class="c1"># determines radial fanning - larger frac means </span>
        <span class="c1"># larger fan (higher xdot velocities)</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">16</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">frac</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">xdot</span> <span class="o">=</span> <span class="n">V</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">frac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span> <span class="o">+</span> <span class="n">buffer</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ydot</span> <span class="o">=</span> <span class="n">V</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">frac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span> <span class="o">+</span> <span class="n">buffer</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">Xdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xdot</span><span class="p">,</span> <span class="n">xdot</span><span class="p">))</span>
        <span class="n">Ydot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ydot</span><span class="p">,</span> <span class="o">-</span><span class="n">ydot</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">Xdot</span><span class="p">,</span> <span class="n">Ydot</span></div>

<div class="viewcode-block" id="Simulation.create_poincare_sc"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.create_poincare_sc">[docs]</a>    <span class="k">def</span> <span class="nf">create_poincare_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">LMR</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">tau_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
    <span class="n">plot_ICs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">monte</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rand_x</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rand_v</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
        <span class="n">xgrid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xdotgrid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            create_poincare_sc - efficiency based Poincar map initial conditions</span>

<span class="sd">                Args:</span>
<span class="sd">                    JC (float): Poincar map Jacobi Constant</span>
<span class="sd">                    LMR (4x1 list): Number of &#39;Left, Middle, Right&#39; ICs to produce</span>
<span class="sd">                        L - Left of the ZVC</span>
<span class="sd">                        M1 - Between the ZVC and L1 point</span>
<span class="sd">                        M2 - Between the L1 point and ZVC</span>
<span class="sd">                        L2 - Right of the ZVC</span>
<span class="sd">                        </span>
<span class="sd">                Opt. Args:</span>
<span class="sd">                    tau_0 (float):     </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">JC</span> <span class="o">=</span> <span class="n">JC</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">LMR</span> <span class="o">=</span> <span class="n">LMR</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span> <span class="o">=</span> <span class="n">tau_0</span>

        <span class="c1"># Think about adding </span>
        <span class="n">L</span><span class="p">,</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">LMR</span>
        <span class="k">if</span> <span class="n">rand_x</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">lim</span><span class="p">)</span>
            <span class="n">xs_left</span> <span class="o">=</span> <span class="o">-</span> <span class="n">lim</span> <span class="o">+</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>

            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">))</span>
            <span class="n">xs_middle</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>
            
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">))</span>
            <span class="n">xs_right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xs_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lim</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>
            <span class="n">xs_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>
            <span class="n">xs_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">),</span> <span class="n">lim</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">5e4</span><span class="p">))</span>

        <span class="n">fx_left</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">x_zvc_func</span><span class="p">(</span><span class="n">xs_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">fx_middle</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">x_zvc_func</span><span class="p">(</span><span class="n">xs_middle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">fx_right</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">x_zvc_func</span><span class="p">(</span><span class="n">xs_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">left</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Past L3</span>
        <span class="n">mask_L</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_left</span> <span class="o">&lt;</span> <span class="n">xs_left</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_left</span><span class="p">)])</span>
        <span class="c1"># Around M1</span>
        <span class="n">mask_LM</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_left</span> <span class="o">&gt;</span> <span class="n">xs_left</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_left</span><span class="p">)])</span>
        <span class="n">mask_ML</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_middle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_middle</span> <span class="o">&lt;</span> <span class="n">xs_middle</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_middle</span><span class="p">)])</span>
        <span class="c1"># Around M2</span>
        <span class="n">mask_MR</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_middle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_middle</span> <span class="o">&gt;</span> <span class="n">xs_middle</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_middle</span><span class="p">)])</span>
        <span class="n">mask_RM</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_right</span> <span class="o">&lt;</span> <span class="n">xs_right</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_right</span><span class="p">)])</span>
        <span class="c1"># Past L2</span>
        <span class="n">mask_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">fx_right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xs_right</span> <span class="o">&gt;</span> <span class="n">xs_right</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fx_right</span><span class="p">)])</span>

        <span class="c1">### THIS IS THE RIGHT FORMAT</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="n">xs_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_L</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_L</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">xs_L</span> <span class="o">=</span> <span class="n">xs_left</span><span class="p">[</span><span class="n">mask_L</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="n">xs_M1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_LM</span><span class="p">)</span>
            <span class="n">right_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_ML</span><span class="p">)</span>
            <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_sum</span><span class="o">/</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sp_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">right_sum</span><span class="o">/</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">xs_M1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xs_left</span><span class="p">[</span><span class="n">mask_LM</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_1</span><span class="p">],</span> 
                <span class="n">xs_middle</span><span class="p">[</span><span class="n">mask_ML</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_2</span><span class="p">]</span>
                <span class="p">))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="n">xs_M2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_MR</span><span class="p">)</span>
            <span class="n">right_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_RM</span><span class="p">)</span>
            <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_sum</span><span class="o">/</span><span class="p">(</span><span class="n">M2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sp_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">right_sum</span><span class="o">/</span><span class="p">(</span><span class="n">M2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">xs_M2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xs_middle</span><span class="p">[</span><span class="n">mask_MR</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_1</span><span class="p">],</span> 
                <span class="n">xs_right</span><span class="p">[</span><span class="n">mask_RM</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_2</span><span class="p">]</span>
                <span class="p">))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="n">xs_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_R</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sp_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_R</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">xs_R</span> <span class="o">=</span> <span class="n">xs_right</span><span class="p">[</span><span class="n">mask_R</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">sp_1</span><span class="p">]</span>


        <span class="nb">print</span><span class="p">(</span><span class="n">xs_L</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_L</span><span class="p">),</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xs_M1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_M1</span><span class="p">),</span> <span class="s1">&#39;M1&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xs_M2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_M2</span><span class="p">),</span> <span class="s1">&#39;M2&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xs_R</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_R</span><span class="p">),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>

        
        <span class="n">Xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xs_L</span><span class="p">,</span> <span class="n">xs_M1</span><span class="p">,</span> <span class="n">xs_M2</span><span class="p">,</span> <span class="n">xs_R</span><span class="p">))</span>
        <span class="c1">#Xs = np.concatenate((xs_left[mask_left], xs_middle[mask_middle], xs_right[mask_right]))</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">density</span>
        <span class="n">xdots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">ydots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">xdot</span><span class="p">,</span> <span class="n">ydot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vxy_raddist</span><span class="p">(</span><span class="n">Xs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">JC</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">rand_v</span><span class="p">)</span>
            <span class="n">xdots</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">D</span><span class="p">:(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdot</span>
            <span class="n">ydots</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">D</span><span class="p">:(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydot</span>
            <span class="n">xs</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">D</span><span class="p">:(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">Xs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

        <span class="n">Odm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">P_ICs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xs</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Odm</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> 
            <span class="n">Odm</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">xdots</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ydots</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Odm</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">P_ICs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New Poincar satellite created..&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">monte</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Poincar sc created..&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">X_grid</span><span class="p">,</span> <span class="n">Xd_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xdotgrid</span><span class="p">)</span>

            <span class="n">X_grid_f</span> <span class="o">=</span> <span class="n">X_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Xd_grid_f</span> <span class="o">=</span> <span class="n">Xd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">ydotgrid</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ydot_griddist</span><span class="p">(</span><span class="n">X_grid_f</span><span class="p">,</span> <span class="n">Xd_grid_f</span><span class="p">,</span> <span class="n">JC</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ydotgrid</span><span class="p">)</span>
            <span class="n">O_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X_grid_f</span><span class="p">)</span>
            <span class="n">grid_ICs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X_grid_f</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">O_grid</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> 
                <span class="n">O_grid</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Xd_grid_f</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ydotgrid</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">O_grid</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">grid_ICs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New Poincar satellite created..&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">monte</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Poincar sc created..&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid_ICs</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">plot_ICs</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">JC</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid_ICs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">grid_ICs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">JC</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plot_henon</span><span class="p">(</span><span class="n">JC</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">P_ICs</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu$ = </span><span class="si">{}</span><span class="s1"> | JC = </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">JC</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">P_ICs</span></div>

<div class="viewcode-block" id="Simulation.create_monte_sc"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.create_monte_sc">[docs]</a>    <span class="k">def</span> <span class="nf">create_monte_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">tau_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
        <span class="n">ds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10e-3</span><span class="p">,</span> <span class="mf">10e-3</span><span class="p">,</span> <span class="mf">10e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            create_monte_sc:</span>
<span class="sd">                Initializes sc based on a randomly peturbed model state</span>

<span class="sd">                    Args:</span>
<span class="sd">                        s0 (1x6 array): model non-dim state</span>
<span class="sd">                        tau_0 = initial non-dim time of mc_scs</span>
<span class="sd">                        N = # of monte sc to create</span>
<span class="sd">                    </span>
<span class="sd">                    Opt Args:</span>
<span class="sd">                        ds (1x6 array): array of perturb ([km] and [km/s])</span>
<span class="sd">                            dX, dY, dZ, dXdot, dYdot, dZdot</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="c1"># Creates array of peturbations</span>
        <span class="n">ds_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1">#/self.l_st</span>
        <span class="n">ds_vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">3</span><span class="p">:][:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1">#*(self.t_st/self.l_st)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ds_pos</span><span class="p">,</span> <span class="n">ds_vel</span><span class="p">))</span>

        <span class="c1"># Add perturbations to model state</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span> <span class="o">+</span> <span class="n">s</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Initialize new monte sc</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New monte satellite created..&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">monte</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgray&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.create_mainifold_sc"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.create_mainifold_sc">[docs]</a>    <span class="k">def</span> <span class="nf">create_mainifold_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_sc</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stable</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            create_manifold_sc:</span>
<span class="sd">                creates N satellite equally spaced around perodic orbit, which</span>
<span class="sd">                    correspond to orbit manifold ICs #Uncomment end of function</span>

<span class="sd">                ** this method uses dyn_sys_tools.maninfold_state()</span>
<span class="sd">                    Not proven to totally work, may need further development</span>

<span class="sd">                ** p_sc must be a very precise periodic IC, none of that literature IC shit</span>

<span class="sd">                Args: </span>
<span class="sd">                    p_sc (sc object): a periodic IC </span>
<span class="sd">                    T (float): period of the IC&#39;s orbit</span>
<span class="sd">                    N (int): number of orbit mainfold trajectories</span>
<span class="sd">                    stable (bool): if True, returns stable mainfold IC&#39;s, else</span>
<span class="sd">                        returns unstable mainfolds</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">p_sc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">tau_f</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">eval_STM</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">STMs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_STMs</span><span class="p">()</span>
        <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">states</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>
        <span class="n">um_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">sm_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">tau_f</span><span class="o">=</span> <span class="n">T</span><span class="p">,</span> <span class="n">eval_STM</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>

            <span class="n">um_states</span><span class="p">,</span> <span class="n">sm_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">manifold_state</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
            
            <span class="n">um_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">um_list</span><span class="p">,</span> <span class="n">um_states</span><span class="p">))</span>
            <span class="n">sm_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sm_list</span><span class="p">,</span> <span class="n">sm_states</span><span class="p">))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sm_sc</span> <span class="ow">in</span> <span class="n">sm_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">sm_sc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">um_sc</span> <span class="ow">in</span> <span class="n">um_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">um_sc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.clear_scs"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.clear_scs">[docs]</a>    <span class="k">def</span> <span class="nf">clear_scs</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            clear_scs:</span>
<span class="sd">                clears satellite object instances from memory</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sats</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Simulation.set_e"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.set_e">[docs]</a>    <span class="k">def</span> <span class="nf">set_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set_e - sets a new eccentricity value of binary system in er3bp </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_e: float</span>
<span class="sd">            new eccentricity of binary system, [0, 1)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">new_e</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model eccentricity set to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_sim_state</span><span class="p">()</span></div>


<div class="viewcode-block" id="Simulation.set_mu"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.set_mu">[docs]</a>    <span class="k">def</span> <span class="nf">set_mu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_mu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set_mu - sets new mass ratio between p1 and p2</span>

<span class="sd">        mu := m1/(m1+m2)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu: float</span>
<span class="sd">            mass ratio of primaries, (0, 0.5]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">new_mu</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model mu set to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_mu</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_sim_state</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Simulation.propogate_func"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.propogate_func">[docs]</a>    <span class="k">def</span> <span class="nf">propogate_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">event_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            propogate_func:</span>
<span class="sd">                function for use in the simulation.propogate_parallel, </span>
<span class="sd">                    simulation.propogate methods</span>

<span class="sd">                    Args:</span>
<span class="sd">                        sc (sc object): sc object for propogation</span>
<span class="sd">                        tau_f (float): final non-dim time</span>
<span class="sd">                        n_outputs (int): number of integration outputs</span>
<span class="sd">                                        (NOT # of integration steps!) </span>
<span class="sd">                        tol (tuple): absolute and relative intergation tolerance, set to</span>
<span class="sd">                            [1e-12, 1e-10] for high precision</span>
<span class="sd">                        eval_STM: if True, propogates STM matrix</span>
<span class="sd">                        p_event: tuple specifing state index and trigger value for poincare map</span>
<span class="sd">                        event_func: func to record events</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        s_new (6xN): sc states at each t_eval</span>
<span class="sd">                        t_new (N): evaluated times</span>

<span class="sd">                    Opt. Returns:</span>
<span class="sd">                        y_hits: states at event triggers</span>
<span class="sd">                        t_hits: times at event triggers </span>
<span class="sd">                         </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## Set analytic propogation flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inert_prop_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prim_prop_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set up integration</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">tau_0</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_tau</span><span class="p">()</span>
        <span class="n">t_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tau_0</span><span class="p">,</span> <span class="n">tau_0</span> <span class="o">+</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eval_STM</span><span class="p">:</span>
            <span class="n">STM</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">STM</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">STM</span><span class="p">))</span>

        <span class="c1"># Numerical integration </span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eom_func</span><span class="p">,</span>  <span class="c1"># Integrtion func</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">state</span><span class="p">,</span>             <span class="c1"># Initial state</span>
            <span class="n">t_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">tau_0</span><span class="p">,</span> <span class="n">tau_0</span> <span class="o">+</span> <span class="n">Dtau</span><span class="p">],</span> 
            <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">,</span>  <span class="c1">#&#39;DOP853&#39;, #    </span>
            <span class="n">t_eval</span> <span class="o">=</span> <span class="n">t_eval</span><span class="p">,</span>        <span class="c1"># Times to output</span>
            <span class="n">max_step</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>        
            <span class="n">atol</span> <span class="o">=</span> <span class="n">tol</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">rtol</span> <span class="o">=</span> <span class="n">tol</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Js</span><span class="p">,</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">epoch</span><span class="p">],</span>
            <span class="n">events</span> <span class="o">=</span> <span class="n">event_func</span>
        <span class="p">)</span>

        <span class="c1"># New states and times for sc</span>
        <span class="n">s_new</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">tau_new</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">event_func</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_hits</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t_events</span>
            <span class="n">y_hits</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y_events</span>

            <span class="k">return</span> <span class="n">s_new</span><span class="p">,</span> <span class="n">tau_new</span><span class="p">,</span> <span class="n">y_hits</span><span class="p">,</span> <span class="n">t_hits</span>

        <span class="k">return</span> <span class="n">s_new</span><span class="p">,</span> <span class="n">tau_new</span></div>
        
<div class="viewcode-block" id="Simulation.propogate_parallel"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.propogate_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">propogate_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;RK45&#39;</span><span class="p">,</span>
            <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">p_event</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            propogate_parallel:</span>
<span class="sd">                propogates scs until tau_f in parallel</span>

<span class="sd">                    Args:</span>
<span class="sd">                        tau_f (float): final non-dim time</span>
<span class="sd">                        n_outputs (float): # of integration outputs</span>
<span class="sd">                        tol (tuple): absolute and relative intergation tolerance, set to</span>
<span class="sd">                            [1e-12, 1e-10] for high precision</span>
<span class="sd">                        eval_STM: if True, propogates STM matrix</span>
<span class="sd">                        p_event: tuple specifing state index and trigger value for poincare map</span>
<span class="sd">                        event_func: func to record events</span>
<span class="sd">                        verbose: if True, prints propogation info</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create multiprocessing pool</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
        <span class="n">prop_partial</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propogate_func</span><span class="p">,</span> <span class="n">Dtau</span> <span class="o">=</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">n_outputs</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span><span class="p">,</span> 
            <span class="n">eval_STM</span> <span class="o">=</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">,</span> <span class="n">p_event</span> <span class="o">=</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">event_func</span> <span class="o">=</span> <span class="n">event_func</span><span class="p">)</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="c1"># Mutliprocess the propogate_func</span>
        <span class="n">sc_props</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">prop_partial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">sc_props</span><span class="p">)</span>

        <span class="c1"># Assign new states and taus to sc</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc_prop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sc_props</span><span class="p">):</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_tau</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">eval_STM</span><span class="p">:</span>
                <span class="n">STMs</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">:,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_STM</span><span class="p">(</span><span class="n">STMs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">event_func</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">events</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">etaus</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_etaus</span><span class="p">(</span><span class="n">etaus</span><span class="p">)</span>
            
        <span class="c1"># Print out computational time and action</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> satellite propogated in parallel&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computaion time </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span></div>

<div class="viewcode-block" id="Simulation.propogate_series"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.propogate_series">[docs]</a>    <span class="k">def</span> <span class="nf">propogate_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;RK45&#39;</span><span class="p">,</span>
            <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">p_event</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            propogate_series: </span>
<span class="sd">                propogates sc in series until t</span>
<span class="sd">                </span>
<span class="sd">                    Args:</span>
<span class="sd">                        tau_f (float): final non-dim time</span>
<span class="sd">                        n_outputs (float): # of integration outputs</span>
<span class="sd">                        tol (tuple): absolute and relative intergation tolerance, set to</span>
<span class="sd">                            [1e-12, 1e-10] for high precision</span>
<span class="sd">                        eval_STM: if True, propogates STM matrix</span>
<span class="sd">                        p_event: tuple specifing state index and trigger value for poincare map</span>
<span class="sd">                        event_func: func to record events</span>
<span class="sd">                        verbose: if True, prints propogation info</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

        <span class="c1"># Propogate sc in seris</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>

            <span class="n">sc_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propogate_func</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">Dtau</span><span class="p">,</span> <span class="n">n_outputs</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">event_func</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_tau</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">eval_STM</span><span class="p">:</span>
                <span class="n">STMs</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_STM</span><span class="p">(</span><span class="n">STMs</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="n">event_func</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">events</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">etaus</span> <span class="o">=</span> <span class="n">sc_prop</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_etaus</span><span class="p">(</span><span class="n">etaus</span><span class="p">)</span>


        <span class="c1"># Print out computational time and action</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> satellite propogated in series&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computaion time </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span></div>

<div class="viewcode-block" id="Simulation.propogate"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.propogate">[docs]</a>    <span class="k">def</span> <span class="nf">propogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau_f</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_outputs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;RK45&#39;</span><span class="p">,</span> <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
        <span class="n">p_event</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">primaries</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            propogate: </span>
<span class="sd">                General propogation function, determines optimal propogation type and</span>
<span class="sd">                    initiates propogation of sim.scs</span>
<span class="sd">                </span>
<span class="sd">                    Args:</span>
<span class="sd">                        tau_f (float): final non-dim time</span>
<span class="sd">                        n_outputs (float): # of integration outputs</span>
<span class="sd">                        tol (tuple): absolute and relative intergation tolerance, set to</span>
<span class="sd">                            [1e-12, 1e-10] for high precision</span>
<span class="sd">                        eval_STM: if True, propogates STM matrix</span>
<span class="sd">                        p_event: tuple specifing state index and trigger value for poincare map</span>
<span class="sd">                        event_func: func to record events</span>
<span class="sd">                        verbose: if True, prints propogation info</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sc</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Decide to prop in parallel or series</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">propogate_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propogate_series</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating in series..&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">propogate_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propogate_parallel</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating in parallel..&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n_outputs</span><span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">n_outputs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tau_f</span> <span class="o">*</span> <span class="mi">500</span><span class="p">))</span>

            <span class="c1"># Propogate sc </span>
            <span class="n">propogate_func</span><span class="p">(</span><span class="n">tau_f</span><span class="p">,</span> <span class="n">n_outputs</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">event_func</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span> 

        <span class="k">if</span> <span class="n">primaries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop_primaries</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">prop_periodic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>

        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>

        <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
            <span class="n">s_f</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">states</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">s_f</span> <span class="o">-</span> <span class="n">S0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Orbit </span><span class="si">{:}</span><span class="s1"> | Error </span><span class="si">{:3.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">err</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">S0</span>


    <span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">parallel</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">prop_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taus</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating Primaries and Lagrange Points&#39;</span><span class="p">)</span>
        <span class="c1">## Populate the primary and Lpoint arrays</span>
        <span class="n">pstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_pstates_func</span><span class="p">()</span>
        <span class="n">Lstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_Lstates_func</span><span class="p">()</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> 
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;CR3BP&#39;</span><span class="p">:</span>
            <span class="n">time_array</span> <span class="o">=</span> <span class="n">taus</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;ER3BP&#39;</span><span class="p">:</span>
            <span class="n">time_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nb</span><span class="o">.</span><span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">time_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">calc_E_series</span><span class="p">(</span><span class="n">taus</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Js</span><span class="p">)</span>
            
        <span class="n">p_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">L_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nb</span><span class="o">.</span><span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="c1"># p_states[i] = tools.cr3bp_pstates(taus[i], self.mu)</span>
            <span class="n">L_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lstates_func</span><span class="p">(</span><span class="n">time_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mu</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">p_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstates_func</span><span class="p">(</span><span class="n">time_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mu</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;CR3BP&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;ER3BP&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_states</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_states</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;BCR4BP&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_states</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_states</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p3_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_states</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">LP_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">L_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">L_states</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">L_states</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> 
            <span class="n">L_states</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">L_states</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prim_prop_flag</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="Simulation.calc_inertial"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_inertial">[docs]</a>    <span class="k">def</span> <span class="nf">calc_inertial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            calc_inertial - calculates inertial state vectors for all sc saved in memory</span>
<span class="sd">                            and saves them as attributes to sc objects</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prim_prop_flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating Primary States..&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop_primaries</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning Inertial calculation..&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

        <span class="c1"># Grab the times to transfrom over</span>
        <span class="n">taus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
        <span class="n">tau0</span> <span class="o">=</span> <span class="n">taus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>

        <span class="c1"># Set up and execute parallel computation of the rotation matrix</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
        <span class="n">transform_partial</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
        <span class="n">Qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_partial</span><span class="p">,</span> <span class="n">taus</span><span class="p">))</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Performing Inertial Transformations..&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
            <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="n">inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1">#numba enchanced</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">set_inert_states</span><span class="p">(</span><span class="n">inert_states</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">LP_inert_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;CR3BP&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;ER3BP&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1_inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2_inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;BCR4BP&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1_inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2_inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p3_inert_states</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3_states</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">L_syn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LP_states</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LP_inert_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transform_mult</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="n">L_syn</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inertial States Calculated..&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compuation time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inert_prop_flag</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Simulation.calc_OE"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_OE">[docs]</a>    <span class="k">def</span> <span class="nf">calc_OE</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calc_OE - calculates orbital elements of saved sc states</span>

<span class="sd">        ** Will calc inertial first if not yet done</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inert_prop_flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_inertial</span><span class="p">()</span>

        <span class="n">calc_OE</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">calc_RV2OE</span>

        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">:</span>
            <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">inert_states</span>
            <span class="n">OE_states</span> <span class="o">=</span> <span class="n">calc_OE</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">oe_states</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;f&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;a&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;e&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="s1">&#39;i&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="s1">&#39;O&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="s1">&#39;w&#39;</span> <span class="p">:</span> <span class="n">OE_states</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="p">}</span></div>

<div class="viewcode-block" id="Simulation.calc_spline"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_spline">[docs]</a>    <span class="k">def</span> <span class="nf">calc_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">periodic</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calc_spline - calculates cubic spline of current sc states using </span>
<span class="sd">            scipy.interpolate.CubicSpline</span>

<span class="sd">            * Sets sc.spline_tau, sc.spline_coeff, and sc.spline_func attr</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sc: class obj</span>
<span class="sd">            sc object from satellite.satellite</span>
<span class="sd">        periodic: bool</span>
<span class="sd">            if True, sets spline boundary condition to &#39;periodic&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
            <span class="n">bc_type</span> <span class="o">=</span> <span class="s1">&#39;Periodic&#39;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;Initial and Final State not sufficiently periodic&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bc_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">cs_obj</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">CubicSpline</span><span class="p">(</span><span class="n">taus</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">bc_type</span> <span class="o">=</span> <span class="n">bc_type</span><span class="p">)</span>

        <span class="n">sc</span><span class="o">.</span><span class="n">spline_tau</span> <span class="o">=</span> <span class="n">cs_obj</span><span class="o">.</span><span class="n">x</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">spline_coeff</span> <span class="o">=</span> <span class="n">cs_obj</span><span class="o">.</span><span class="n">c</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">spline_func</span> <span class="o">=</span> <span class="n">cs_obj</span></div>




<div class="viewcode-block" id="Simulation.calc_FTLE"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_FTLE">[docs]</a>    <span class="k">def</span> <span class="nf">calc_FTLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            calc_FTLE:</span>
<span class="sd">                calculates Finite Time Lyapunov Exponents for </span>
<span class="sd">                sc trajectories in memory</span>

<span class="sd">                Uses dyn_sys_tools.py</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning FTLE calculation..&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">pbar</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)):</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">FTLE</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">)</span>
            

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FTLEs Calculated..&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compuation time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">calc_STMs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning STM calculation..&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">))</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">STMs</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STMs Calculated..&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compuation time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

<div class="viewcode-block" id="Simulation.calc_JC"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_JC">[docs]</a>    <span class="k">def</span> <span class="nf">calc_JC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            calc_JC:</span>
<span class="sd">                calculates Jacobi Constant value for </span>
<span class="sd">                sc trajectories in memory</span>

<span class="sd">                Uses models.py</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning JC calculation..&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="c1"># Create multiprocessing pool</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
        <span class="n">JCs_partial</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">JCs</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Mutliprocess the propogate_func</span>
        <span class="n">sc_props</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">JCs_partial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="c1">#raise Exception(&#39;Testing&#39;)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc_prop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sc_props</span><span class="p">):</span>
            <span class="n">JCs</span> <span class="o">=</span> <span class="n">sc_prop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_JCs</span><span class="p">(</span><span class="n">JCs</span><span class="p">)</span>

        <span class="c1"># bar = self.progress_bar(len(self.sats))</span>
        <span class="c1"># bar.start()</span>
        <span class="c1"># for i, sc in enumerate(self.sats):</span>
        <span class="c1">#     tools.JCs(sc, self.model)</span>
        <span class="c1">#     bar.update(i+1)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;JCs Calculated..&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compuation time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span></div>
 
<div class="viewcode-block" id="Simulation.calc_poincare"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.calc_poincare">[docs]</a>    <span class="k">def</span> <span class="nf">calc_poincare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau_f</span><span class="p">,</span> <span class="n">p_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calc_poincare - calculates Poincar map of current satellites</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    tau_f (flt): final ndim time</span>
<span class="sd">                    p_event (tuple) [n, t]:</span>
<span class="sd">                        n - element in state vector </span>
<span class="sd">                        t - element value to trigger event </span>

<span class="sd">                Example:</span>
<span class="sd">                    I want to record x-z plane crossings. Therefore, I need</span>
<span class="sd">                    to record when the y component is zero.</span>

<span class="sd">                    n : y is the 1 index in the state vector</span>
<span class="sd">                    t : the trigger value should be set to 0</span>

<span class="sd">                    p_event = [1, 0]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">tau_f</span><span class="p">,</span> <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">p_event</span> <span class="o">=</span> <span class="n">p_event</span><span class="p">,</span> <span class="n">n_outputs</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span>
            <span class="n">event_func</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">poincare</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">])</span></div>

        <span class="c1"># if save:</span>
        <span class="c1">#     JC_func = self.model.get_JC_func()</span>
        <span class="c1">#     Nsc = len(self.sats)</span>
        <span class="c1">#     Ttot = tau_f</span>
            
        <span class="c1">#     S_inits = np.ndarray((Nsc))</span>
        <span class="c1">#     Events = np.ndarray((Nsc), )</span>

        <span class="c1">#     for i, sc in enumerate(self.sats):</span>
        <span class="c1">#         print(sc.get_events()[0].T)</span>
        <span class="c1">#         for event in sc.get_events()[0]</span>

        <span class="c1">#         S_inits[i, :] = sc.get_states().T[0]</span>

            <span class="c1">#JC = JC_func(s0) ]</span>
         
<div class="viewcode-block" id="Simulation.plot_orbit"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.plot_orbit">[docs]</a>    <span class="k">def</span> <span class="nf">plot_orbit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">inertial</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">Lpoints</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
        <span class="n">lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">zvc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zvc_JC</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">FTLE</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_f</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sun_scale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">D2</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">D2_axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cont</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zvc_res</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">v_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">arrows</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">num_arrows</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">arr_size</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">trail</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> 
        <span class="n">reverse_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c_array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            plot_orbit:</span>
<span class="sd">                plots all sc motion in memory in specified format</span>

<span class="sd">                    Opt Args:</span>
<span class="sd">                        l_dim (bool): Length dimension</span>
<span class="sd">                        t_dim (bool): Time dimension</span>
<span class="sd">                        inertial (bool): Inertial coord. frame</span>
<span class="sd">                        lims (1x3): sets non-dim frame size [x, y, z]</span>
<span class="sd">                        FTLE (bool): if True, displays FTLE values along trajectory</span>
<span class="sd">                        tau_f (flt): Final epoch to plot to-- mainly for gif generation</span>
<span class="sd">                        scale (bool): if False, reduces scale of Sun in BCR4BP</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        
        <span class="k">if</span> <span class="n">tau_f</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tau_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_tau</span><span class="p">()</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sun_scale</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c1"># Set dim/non-dim quants</span>
        <span class="k">if</span> <span class="n">l_dim</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_st</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;[km]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;[ndim]&#39;</span>


        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_st</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">D2_axis</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">D2_axis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">D2_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">D2_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># Initialize figure object</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Setting plot attributes</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">:</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">D2</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xlim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">ylim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;3d&#39;</span><span class="p">)</span>

                <span class="n">xlim</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
                <span class="n">zlim</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xlim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">ylim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">zlim</span><span class="p">,</span> <span class="n">zlim</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">ylim</span><span class="o">/</span><span class="n">xlim</span><span class="p">,</span> <span class="n">zlim</span><span class="o">/</span><span class="n">xlim</span><span class="p">])</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_dict</span><span class="p">[</span><span class="s1">&#39;plasma&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reverse_cmap</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">reversed</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">c_array</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">((</span><span class="n">c_array</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c_array</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">c_array</span><span class="p">)</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c_array</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span> <span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="s1">&#39;plasma&#39;</span><span class="p">)</span>

            <span class="n">col_bar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="o">=</span> <span class="nb">map</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>



        <span class="c1"># Plot each sc</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prim_prop_flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating Primaries..&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop_primaries</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>

            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
            <span class="n">tau_0</span> <span class="o">=</span> <span class="n">taus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tau_f</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tau_f</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_tau</span><span class="p">()</span>

            <span class="n">tau_mask</span> <span class="o">=</span> <span class="n">taus</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tau_f</span><span class="p">)</span>

            <span class="n">tau_trail</span> <span class="o">=</span> <span class="n">tau_f</span> <span class="o">-</span> <span class="n">trail</span>
            <span class="n">arg_trail</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taus</span> <span class="o">-</span> <span class="n">tau_trail</span><span class="p">))</span>

            <span class="c1"># Inertial coordinate plotting</span>
            <span class="k">if</span> <span class="n">inertial</span><span class="p">:</span>
                <span class="c1"># set inert states</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inert_prop_flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Propogating Inertial States..&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calc_inertial</span><span class="p">()</span>

                <span class="n">sc_states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">states_inert</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">p1_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_inert_states</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">p2_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_inert_states</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">Lstates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LP_inert_states</span><span class="p">[:,</span> <span class="n">tau_mask</span><span class="p">][:,</span> <span class="n">arg_trail</span><span class="p">:]</span>

            <span class="k">elif</span> <span class="n">inertial</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># set syn states</span>
                <span class="n">sc_states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">p1_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_states</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">p2_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_states</span><span class="p">[</span><span class="n">tau_mask</span><span class="p">][</span><span class="n">arg_trail</span><span class="p">:]</span>
                <span class="n">Lstates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LP_states</span><span class="p">[:,</span> <span class="n">tau_mask</span><span class="p">][:,</span> <span class="n">arg_trail</span><span class="p">:]</span>

                <span class="c1"># Plots 3d wireframe at last epoch and first sc</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">D2</span><span class="p">:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pimary_2d</span><span class="p">(</span><span class="n">p1_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">D2_axis</span><span class="p">,</span> <span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> 
                                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">r_scale</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pimary_2d</span><span class="p">(</span><span class="n">p2_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">D2_axis</span><span class="p">,</span> <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> 
                                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">r_scale</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p1_states</span><span class="p">[:,</span> <span class="n">p</span><span class="p">],</span> <span class="n">p1_states</span><span class="p">[:,</span> <span class="n">q</span><span class="p">],</span> 
                            <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p2_states</span><span class="p">[:,</span> <span class="n">p</span><span class="p">],</span> <span class="n">p2_states</span><span class="p">[:,</span> <span class="n">q</span><span class="p">],</span> 
                            <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">Lpoints</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Lstates</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="n">Lstates</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> 
                                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blueviolet&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span> 

                        <span class="n">Llist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="s1">&#39;L3&#39;</span><span class="p">,</span> <span class="s1">&#39;L4&#39;</span><span class="p">,</span> <span class="s1">&#39;L5&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Lstates</span><span class="p">):</span>
                            
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L</span><span class="p">[:,</span> <span class="n">p</span><span class="p">],</span> <span class="n">L</span><span class="p">[:,</span> <span class="n">q</span><span class="p">],</span>  
                                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blueviolet&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Llist</span><span class="p">[</span><span class="n">L_i</span><span class="p">],</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">l</span><span class="p">),</span> <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>

                        <span class="c1">#if labels:</span>


                    
                <span class="k">elif</span> <span class="n">D2</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__primary_3d</span><span class="p">(</span><span class="n">p1_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">r_scale</span><span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__primary_3d</span><span class="p">(</span><span class="n">p2_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">r_scale</span><span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p1_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p1_states</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                            <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p2_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p2_states</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                            <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">Lpoints</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Lstates</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Lstates</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Lstates</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blueviolet&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>

                        <span class="n">Llist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="s1">&#39;L3&#39;</span><span class="p">,</span> <span class="s1">&#39;L4&#39;</span><span class="p">,</span> <span class="s1">&#39;L5&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Lstate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Lstates</span><span class="p">):</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lstate</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Lstate</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Lstate</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> 
                                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blueviolet&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>  
                            <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">Lstate</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">Lstate</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">Lstate</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">Llist</span><span class="p">[</span><span class="n">L_i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
    

                    <span class="c1">###!!! add back in when systems are implemented</span>
                    <span class="c1"># if self.dynamics == &#39;BCR4BP&#39;:</span>
                    <span class="c1">#     p3_state = self.p3_inert_states[:, -1]</span>
                        
                    <span class="c1">#     if D2:</span>
                    <span class="c1">#         sun = self.__sun_2d(s_state/s, axis = D2_axis, l = l)</span>
                    <span class="c1">#         ax.add_artist(sun)</span>
                    <span class="c1">#     else:</span>
                    <span class="c1">#         sun = self.__sun_3d(s_state/s)*l</span>
                    <span class="c1">#         ax.plot_wireframe(sun[0], sun[1], sun[2], color = &#39;darkorange&#39;)</span>



            <span class="k">if</span> <span class="n">D2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">color</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sc_states</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[:,</span> <span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sc_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">D2</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sc_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sc_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">sc_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>



        <span class="c1">#     if FTLE == False and cont == False:</span>
        <span class="c1">#         # Plot light color for monte scs</span>
        <span class="c1">#         if D2:</span>
        <span class="c1">#             dim1 = states[p]*l </span>
        <span class="c1">#             dim2 = states[q]*l</span>
        <span class="c1">#             if type(sc.color) == type(&#39;&#39;):</span>
        <span class="c1">#                 ax.plot(dim1, dim2, color = sc.color, alpha = sc.alpha, lw = lw)</span>
        <span class="c1">#             elif type(sc.color) == type(np.double(1.2)):</span>
        <span class="c1">#                 print(sc.color)</span>
        <span class="c1">#                 scat = ax.scatter(dim1, dim2, c = sc.color*np.ones_like(dim1), </span>
        <span class="c1">#                     alpha = alpha, s = 0.5, cmap = &#39;jet&#39;, vmin = scat_min, vmax = scat_max, </span>
        <span class="c1">#                     rasterized = True)</span>
        <span class="c1">#             ### bring back!</span>
        <span class="c1">#             #ax.scatter(dim1[-1], dim2[-1], color = &#39;black&#39;, s = 0.5)</span>
        <span class="c1">#             if arrows:</span>
        <span class="c1">#                 num_states = len(dim1)</span>
        <span class="c1">#                 num_arr_states = int(num_states/num_arrows)</span>
            

        <span class="c1">#                 for i in range(num_arrows):</span>
        <span class="c1">#                     dstate = 1</span>
        <span class="c1">#                     x0 = dim1[1 + i*num_arr_states] </span>
        <span class="c1">#                     x1 = dim1[1 +i*num_arr_states + dstate] </span>
        <span class="c1">#                     y0 = dim2[1 +i*num_arr_states] </span>
        <span class="c1">#                     y1 = dim2[1 +i*num_arr_states + dstate] </span>
        <span class="c1">#                     ax.arrow(x0, y0, x1-x0, y1-y0, width = 0, head_width = arr_size,</span>
        <span class="c1">#                     color = &#39;black&#39;, zorder = 3, head_starts_at_zero = False, overhang = 0.1)</span>
        <span class="c1">#         else:</span>
        <span class="c1">#             ax.plot(x, y, z, color = sc.color, alpha = alpha, lw = lw)</span>
        <span class="c1">#             ax.scatter(x[-1], y[-1], z[-1], color = &#39;black&#39;, s = 0.5)</span>

        <span class="c1">#     elif FTLE == True:</span>
        <span class="c1">#         FTLEs = sc.FTLEs[mask]</span>

        <span class="c1">#         vmin = np.min(self.sats[0].FTLEs[:-5],)</span>
        <span class="c1">#         vmax = np.max(self.sats[0].FTLEs)</span>
        <span class="c1">#         if D2:</span>
                    
        <span class="c1">#             dim1 = states[p]*l </span>
        <span class="c1">#             dim2 = states[q]*l</span>
        <span class="c1">#             scat = ax.scatter(dim1, dim2, c = FTLEs, s = 1, marker = m,</span>
        <span class="c1">#                 cmap = &#39;inferno&#39;, vmin = vmin, vmax = vmax)</span>
        <span class="c1">#         else:</span>
        <span class="c1">#             scat = ax.scatter(x, y, z, c = FTLEs, s = 1, marker = m,</span>
        <span class="c1">#                 cmap = &#39;inferno&#39;, vmin = vmin, vmax = vmax)</span>
        <span class="c1">#         if i == 0 and cbar == True:</span>
        <span class="c1">#             fig.colorbar(scat, pad = .05, shrink = 0.5, orientation = &#39;vertical&#39;,</span>
        <span class="c1">#             label = r&#39;$ \sigma_{t_0}^{t} $ [ndim] &#39;)</span>

        <span class="c1">#     elif cont == True:</span>
        <span class="c1">#         vmin = 0</span>
        <span class="c1">#         vmax = 0.0549</span>
        <span class="c1">#         dim1 = states[p]*l </span>
        <span class="c1">#         dim2 = states[q]*l</span>

        <span class="c1">#         print(e)</span>
        <span class="c1">#         scat = ax.scatter(dim1, dim2, c = e*np.ones_like(dim1), s = 1, marker = m,</span>
        <span class="c1">#             cmap = &#39;cividis_r&#39;, vmin = vmin, vmax = vmax)</span>





        <span class="c1"># if D2:</span>
        <span class="c1">#     if zvc:</span>
        <span class="c1">#         if zvc_JC == None:</span>
        <span class="c1">#             JC_func = self.model.get_JC_func()</span>
        <span class="c1">#             s = states.T[0]</span>
        <span class="c1">#             JC = JC_func(tau_f, s)</span>

        <span class="c1">#         levels = JC + np.array([0, 1e-2])</span>
        <span class="c1">#         xlim = lims[0]</span>
        <span class="c1">#         ylim = lims[1]</span>
        <span class="c1">#         x = np.linspace(-xlim, xlim, zvc_res)</span>
        <span class="c1">#         y = np.linspace(-ylim, ylim, zvc_res)</span>
        <span class="c1">#         X, Y = np.meshgrid(x, y)</span>
        <span class="c1">#         Ust = 2*(0.5*(X**2 + Y**2) + (1-self.mu)/np.sqrt((X + self.mu)**2 + Y**2 ) + self.mu/np.sqrt((X - (1-self.mu))**2 + Y**2))</span>

        <span class="c1">#         ax.contourf(X, Y, Ust, levels = levels, cmap = &#39;gray&#39;)</span>
        <span class="c1">#         ax.annotate(text = &#39;JC = {}&#39;.format(round(JC, 5)), xy = [-1, 1.2], size = 12)</span>



        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> | T: </span><span class="si">{}</span><span class="s1"> days&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">,</span> 
                <span class="nb">round</span><span class="p">(</span><span class="n">tau_f</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> | T: </span><span class="si">{}</span><span class="s1"> [ndim/2]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">tau_f</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>


        <span class="c1"># if labels:</span>
        <span class="c1">#     Llist = [&#39;L1&#39;, &#39;L2&#39;, &#39;L3&#39;, &#39;L4&#39;, &#39;L5&#39;]</span>
        <span class="c1">#     for i, L in enumerate(L_states_syn):</span>
        <span class="c1">#         ax.annotate(Llist[i], xy = (L[0]*l, L[1]*l+ 0.05*l), ha = &#39;center&#39;, fontsize = 12)</span>

        <span class="c1">#     Plist = [&#39;Earth&#39;, &#39;Moon&#39;, &#39;Sun&#39;]</span>
        <span class="c1">#     for i, prim in enumerate(pstates_func(tau_f)):</span>
        <span class="c1">#         ax.annotate(Plist[i], xy = (prim[0]*l, prim[1]*l+ 0.05*l), ha = &#39;center&#39;, fontsize = 12)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="c1">#fig.tight_layout()</span>

        <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">col_bar</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Simulation.plot_primaries"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.plot_primaries">[docs]</a>    <span class="k">def</span> <span class="nf">plot_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau_f</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            plot_primaries:</span>
<span class="sd">                plots 2D orbital motion of primaries -</span>
<span class="sd">                mainly used for model analysis</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tau_f</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
            <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau_f</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">char_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">][</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
        <span class="n">shift_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">m_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus</span><span class="p">)))</span>
        <span class="n">e_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus</span><span class="p">)))</span>

        <span class="n">pstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_pstates_func</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">taus</span><span class="p">):</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">taus</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tau</span><span class="p">)</span>
            <span class="n">det</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
            <span class="n">e_state</span><span class="p">,</span> <span class="n">m_state</span> <span class="o">=</span> <span class="n">pstates_func</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>

            <span class="n">m_states</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">@</span> <span class="p">(</span><span class="n">m_state</span><span class="p">)</span> 
            <span class="n">e_states</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">@</span> <span class="p">(</span><span class="n">e_state</span><span class="p">)</span>

        <span class="c1"># l = self.l_st</span>
        <span class="c1"># t = 3.758e5</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_states</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_states</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e_states</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e_states</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y [ndim] (inert)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [ndim] (inert)&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>

<div class="viewcode-block" id="Simulation.plot_poincare"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.plot_poincare">[docs]</a>    <span class="k">def</span> <span class="nf">plot_poincare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            plot_poincare:</span>
<span class="sd">                Plots poincare map from existing sc propogations</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    axis (str list): elements of state vector to form axis</span>
<span class="sd">                        Options: [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;xdot&#39;, &#39;ydot&#39;, &#39;zdot&#39;]</span>

<span class="sd">                    projection (str): </span>
<span class="sd">                        if &#39;3d&#39;, produces 3d plot-- needs 3rd axis</span>

<span class="sd">                Example:</span>
<span class="sd">                    axis = [&#39;x&#39;, &#39;xdot&#39;]</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="c1">#ax.set_ylabel(axis[1])</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;3d&#39;</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">pstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_pstates_func</span><span class="p">()</span>
        <span class="n">Lstates_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_Lstates_func</span><span class="p">()</span>
        <span class="n">e_state</span><span class="p">,</span> <span class="n">m_state</span> <span class="o">=</span> <span class="n">pstates_func</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">Lstates</span> <span class="o">=</span> <span class="n">Lstates_func</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">:</span>
            <span class="n">estates</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_events</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;3d&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">estates</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">estates</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">estates</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#sx0 = sc.get_states().T[0, 0]</span>
                <span class="c1">#color = np.ones_like(estates[q])*sx0</span>
                <span class="c1">#C = ax.scatter(estates[p], estates[q], marker = m, s = 0.1, </span>
                 <span class="c1">#   c = color, vmin = -0, vmax = 1, cmap = &#39;viridis&#39;)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estates</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="n">estates</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estates</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">estates</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1">#fig.colorbar(C)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">e_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span></div>

        <span class="c1"># for i, L in enumerate(Lstates):</span>
        <span class="c1">#     ax.scatter(L[0], 0, s = 5, marker = &#39;.&#39;, color = &#39;purple&#39;)</span>
   
<div class="viewcode-block" id="Simulation.plot_FTLE"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.plot_FTLE">[docs]</a>    <span class="k">def</span> <span class="nf">plot_FTLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            plot_FTLE:</span>
<span class="sd">                plots the Finite Time Lyapunov Exponent as a function </span>
<span class="sd">                of time for all scs</span>

<span class="sd">                Args:</span>
<span class="sd">                    t_dim (bool): if True, uses dimensional time</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_st</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">:</span>

            <span class="n">tau_f</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_tau</span><span class="p">()</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
            <span class="n">FTLE</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">FTLEs</span>

            <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
                <span class="n">taus</span> <span class="o">=</span> <span class="n">taus</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">taus</span> <span class="o">=</span> <span class="n">taus</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">monte</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">,</span> <span class="n">FTLE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightcoral&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">FTLE</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T [days]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T [ndim/2]&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$ \sigma_</span><span class="si">{t_0}</span><span class="s1">^</span><span class="si">{t}</span><span class="s1">$ &#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">))</span></div>

<div class="viewcode-block" id="Simulation.plot_JC"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.plot_JC">[docs]</a>    <span class="k">def</span> <span class="nf">plot_JC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            plot_FTLE:</span>
<span class="sd">                plots the Finite Time Lyapunov Exponent as a function </span>
<span class="sd">                of time for all scs</span>

<span class="sd">                Args:</span>
<span class="sd">                    t_dim (bool): if True, uses dimensional time</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_st</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">:</span>

            <span class="n">tau_f</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_tau</span><span class="p">()</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
            <span class="n">JCs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_JCs</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
                <span class="n">taus</span> <span class="o">=</span> <span class="n">taus</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">taus</span> <span class="o">=</span> <span class="n">taus</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">monte</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">,</span> <span class="n">JCs</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightcoral&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">,</span> <span class="n">JCs</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">t_dim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T [days]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T [ndim/2]&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$ JC$ &#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">JCs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">JCs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">3.1883</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">3.1722</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">3.0125</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L3&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">2.9880</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L4/5&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;turquoise&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">plot_henon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">JC</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="mf">1e5</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">density</span><span class="p">))</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">xdot</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">henon_curve</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">JC</span><span class="o">=</span> <span class="n">JC</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xdot</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">xdot</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Simulation.movie_orbit"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.movie_orbit">[docs]</a>    <span class="k">def</span> <span class="nf">movie_orbit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propogate</span><span class="p">,</span> <span class="n">tau_f</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">gif_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
        <span class="n">l_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t_dim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">inertial</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">L_points</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
        <span class="n">lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">FTLE</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sun_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">D2</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zvc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scat_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scat_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">trail</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; movie_orbit - integrates and creates a gif of dynamics in configuration </span>
<span class="sd">            space from the current lead sc time to some tau_f</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    tau_f (float): the final non-dim time</span>
<span class="sd">                    frames (float): # of frames to create, impacts time to render</span>
<span class="sd">                    fps (float): frames per second</span>
<span class="sd">                    gif_name (str): file name of the gif.. appendend with {}.gif</span>

<span class="sd">                    l_dim (bool): if true, plots in dimensional lengths</span>
<span class="sd">                    t_dim (bool): if true, plots in dimensional time</span>
<span class="sd">                    inertial (bool): if true, plots in inertial coord</span>
<span class="sd">                    lims (1x3): non-dim array of of coord limits</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get last time of lead sc and create tau array</span>
        <span class="n">tau_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-3</span>
        <span class="n">taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tau_0</span><span class="p">,</span> <span class="n">tau_f</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">propogate</span><span class="p">:</span>
            <span class="c1"># Integrate and plot each time step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">tau_f</span><span class="p">,</span> <span class="n">eval_STM</span><span class="o">=</span> <span class="n">eval_STM</span><span class="p">,</span> <span class="n">prop_prims</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">FTLE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_FTLE</span><span class="p">()</span>


        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rendering movie..&#39;</span><span class="p">)</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tau_f</span> <span class="ow">in</span> <span class="n">pbar</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">taus</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_orbit</span><span class="p">(</span><span class="n">tau_f</span> <span class="o">=</span> <span class="n">tau_f</span><span class="p">,</span> <span class="n">l_dim</span><span class="o">=</span> <span class="n">l_dim</span><span class="p">,</span> <span class="n">t_dim</span> <span class="o">=</span> <span class="n">t_dim</span><span class="p">,</span> <span class="n">inertial</span><span class="o">=</span> <span class="n">inertial</span><span class="p">,</span>
            <span class="n">Lpoints</span><span class="o">=</span> <span class="n">L_points</span><span class="p">,</span> <span class="n">lims</span> <span class="o">=</span> <span class="n">lims</span><span class="p">,</span> <span class="n">zvc</span> <span class="o">=</span> <span class="n">zvc</span><span class="p">,</span> <span class="n">FTLE</span> <span class="o">=</span> <span class="n">FTLE</span><span class="p">,</span> <span class="n">D2</span> <span class="o">=</span> <span class="n">D2</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="n">scat_max</span><span class="p">,</span>
            <span class="n">v_min</span> <span class="o">=</span> <span class="n">scat_min</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span> <span class="n">cbar</span><span class="p">,</span> <span class="n">trail</span> <span class="o">=</span> <span class="n">trail</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span> <span class="n">labels</span><span class="p">)</span>
                
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;gif_images/image</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
            <span class="c1"># save frame</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="c1"># build gif</span>
        <span class="k">if</span> <span class="n">gif_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y&quot;</span><span class="p">)</span>
            <span class="n">gif_name</span> <span class="o">==</span> <span class="n">d1</span>

            <span class="nb">print</span><span class="p">()</span>

        <span class="n">gif_file</span> <span class="o">=</span> <span class="s1">&#39;gif_animations/</span><span class="si">{}</span><span class="s1">.gif&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gif_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span><span class="n">gif_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">fps</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                
        <span class="c1"># Remove files</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Movie rendered..&#39;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__pimary_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> 
                    <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __pimary_2d - generates circle object to be plotted</span>

<span class="sd">            Args:</span>
<span class="sd">                state (array) : state of the primary</span>
<span class="sd">                axis ([str, str]) : axis to plot</span>
<span class="sd">                mass (float) : the ndim mass, [0, 1]</span>
<span class="sd">                color (str) : color of circle</span>

<span class="sd">            Opt Args:</span>
<span class="sd">                beta (float) : mass to radius relation, 0.8 for stars</span>
<span class="sd">                l (float) : char length factor</span>
<span class="sd">                r_scale (float) : radius scaling factor</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">r_scale</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>

        <span class="n">pimary_circ</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pimary_circ</span>


    <span class="k">def</span> <span class="nf">__primary_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __pimary_3d:</span>
<span class="sd">            produces 3D wireplot state vector of primary in the synodic frame</span>

<span class="sd">            Args:</span>
<span class="sd">                state (array) : state of the primary</span>
<span class="sd">                axis ([str, str]) : axis to plot</span>
<span class="sd">                mass (float) : the ndim mass, [0, 1]</span>
<span class="sd">                color (str) : color of circle</span>

<span class="sd">            Opt Args:</span>
<span class="sd">                beta (float) : mass to radius relation, 0.8 for stars</span>
<span class="sd">                l (float) : char length factor</span>
<span class="sd">                r_scale (float) : radius scaling factor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">r_scale</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">radius</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">radius</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">radius</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span><span class="o">*</span><span class="n">l</span>

        <span class="k">return</span> <span class="n">sun</span>

    <span class="k">def</span> <span class="nf">__earth_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>

        <span class="n">R_e</span> <span class="o">=</span> <span class="mi">6371</span> <span class="c1">#km</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>

        <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">R_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span><span class="p">)</span><span class="o">*</span><span class="n">l</span>
 
        <span class="n">earth</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumblue&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">earth</span>

    <span class="k">def</span> <span class="nf">__moon_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>

        <span class="n">R_m</span> <span class="o">=</span> <span class="mi">1737</span> <span class="c1">#km</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>

        <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">R_m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span><span class="p">)</span><span class="o">*</span><span class="n">l</span>
 
        <span class="n">earth</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgray&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">earth</span>

    <span class="k">def</span> <span class="nf">__sun_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">R_s</span> <span class="o">=</span> <span class="mi">695500</span> <span class="c1">#km</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">*</span><span class="n">l</span>

        <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">R_s</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span><span class="p">)</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="n">s</span>
        <span class="n">sun</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sun</span>

    <span class="k">def</span> <span class="nf">__earth_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            __earth_3d:</span>
<span class="sd">            produces 3D wireplot state vector of Earth in the synodic frame</span>

<span class="sd">                Args:</span>
<span class="sd">                    r (1x6 array): position of Earth in ndim synodic frame</span>

<span class="sd">                Returns </span>
<span class="sd">                    earth (1x6 array): Earth wireframe state vector</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">R_e</span> <span class="o">=</span> <span class="mi">6371</span> <span class="c1">#km</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">earth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">earth</span> 

    <span class="k">def</span> <span class="nf">__moon_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __moon_3d:</span>
<span class="sd">            produces 3D wireplot state vector of Moon in the synodic frame</span>

<span class="sd">                Args:</span>
<span class="sd">                    r (1x6 array): position of Moon in ndim synodic frame</span>

<span class="sd">                Returns </span>
<span class="sd">                    moon (1x6 array): Moon wireframe state vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R_m</span> <span class="o">=</span> <span class="mi">1737</span> <span class="c1">#km</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">R_m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l_st</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">moon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">moon</span> 

    <span class="k">def</span> <span class="nf">__sun_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __sun_3d:</span>
<span class="sd">            produces 3D wireplot state vector of Sun in the synodic frame</span>

<span class="sd">                Args:</span>
<span class="sd">                    r (1x6 array): position of Sun in ndim synodic frame</span>

<span class="sd">                Returns </span>
<span class="sd">                    sun (1x6 array): Sun wireframe state vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#R_s = 695500 #km</span>


        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># x = (np.cos(u)*np.sin(v))*R_s/self.l_st + r[0, None]</span>
        <span class="c1"># y = (np.sin(u)*np.sin(v))*R_s/self.l_st + r[1, None]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">sun</span>
    
<div class="viewcode-block" id="Simulation.progress_bar"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.progress_bar">[docs]</a>    <span class="k">def</span> <span class="nf">progress_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            progress_bar:</span>
<span class="sd">                progress bar object used for indicating calculation processes</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bar</span> <span class="o">=</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">maxval</span><span class="o">=</span> <span class="n">tot</span><span class="p">,</span> \
            <span class="n">widgets</span><span class="o">=</span><span class="p">[</span><span class="n">progressbar</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">Percentage</span><span class="p">()])</span>

        <span class="k">return</span> <span class="n">bar</span></div>

<div class="viewcode-block" id="Simulation.single_shooter"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.single_shooter">[docs]</a>    <span class="k">def</span> <span class="nf">single_shooter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T_b</span><span class="p">,</span> <span class="n">Xd</span><span class="p">,</span> <span class="n">Xd_b</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; single_shooter - General single shooting algorithm for state targeting</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    s0 (1x6 array): initial state </span>
<span class="sd">                    s_b (1x6 array): state boolean array - sets design variables</span>
<span class="sd">                    T0 (float): initial propogation time</span>
<span class="sd">                    T_b (1x1 array): time boolean array - sets time as design variable</span>
<span class="sd">                    </span>
<span class="sd">                    Xd (1xN): constraint variables desired values</span>
<span class="sd">                    Xd_b (1x6): sets which state elements are the constraints</span>

<span class="sd">                Opt Args:</span>
<span class="sd">                    tol (flt): tolerance to satisfy for norm of the constrain </span>
<span class="sd">                        function, ||F(X)||</span>
<span class="sd">                    ax (mpl axes object): axes object to plot updated trajectory</span>

<span class="sd">                Returns:</span>
<span class="sd">                    s_i (1x6 array): Solved periodic IC</span>
<span class="sd">                    T_i (float): Solved period</span>

<span class="sd">                Example:</span>
<span class="sd">                    I want to find a L1 Lyapunov orbit with a period of 2.94 ndim</span>
<span class="sd">                    using perpendicular crossings</span>
<span class="sd">                    </span>
<span class="sd">                        # Initial Guesses</span>
<span class="sd">                        s0 = [0.8115, 0, 0, 0, 0.255, 0]</span>
<span class="sd">                        T0 = 2.94</span>

<span class="sd">                        T_b = [False] # Don&#39;t change the period</span>
<span class="sd">                        Xd  = [0, 0] # Perpendicular crossing requires y_f = 0, vx_f = 0</span>
<span class="sd">                        Xd_b = [False, True, False, True, False, False] </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">X_els</span><span class="p">,</span> <span class="n">FX_els</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">init_shooter</span><span class="p">(</span><span class="n">s_b</span><span class="p">,</span> <span class="n">T_b</span><span class="p">,</span> <span class="n">Xd_b</span><span class="p">)</span>

        <span class="c1"># if ax == None:</span>
        <span class="c1">#    fig = plt.figure(figsize= [8, 8])</span>
        <span class="c1">#    ax = fig.add_subplot(projection = &#39;3d&#39;)</span>

        <span class="c1">### Take out later! </span>
        <span class="n">state_solutions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">per_solutions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Initial set</span>
        <span class="n">T_i</span> <span class="o">=</span> <span class="n">T0</span>
        <span class="n">s_i</span> <span class="o">=</span> <span class="n">s0</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mi">1</span> 
        <span class="n">FX_i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ratio_old</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">s_i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">T_i</span><span class="p">,</span> <span class="n">eval_STM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-14</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">])</span>

            <span class="n">X_ip1</span><span class="p">,</span> <span class="n">FX_ip1</span><span class="p">,</span> <span class="n">DFX_ip1</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">shooter_update_state</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">X_els</span><span class="p">,</span> <span class="n">FX_els</span><span class="p">,</span> <span class="n">Xd</span><span class="p">,</span> <span class="n">T_i</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Js</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">X_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X_els</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">X_el</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">T_i</span> <span class="o">=</span> <span class="n">X_ip1</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s_i</span><span class="p">[</span><span class="n">X_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_ip1</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>

            <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">FX_ip1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final State Error&#39;</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">s_i</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">T_i</span><span class="p">)</span>
            <span class="c1"># print(&#39;State:&#39;, s_i)</span>
            <span class="c1"># print(&#39;Period&#39;, 2*T_i)</span>

            <span class="c1"># state_solutions.append(s_i)</span>
            <span class="c1"># per_solutions.append(2*T_i)</span>
            <span class="c1"># error_list.append(eps)</span>
            <span class="k">if</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solution Failed!&#39;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">s_i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">T_i</span><span class="p">)</span>
 
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_orbit</span><span class="p">(</span><span class="n">inertial</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">Lpoints</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved State&#39;</span><span class="p">,</span> <span class="n">s_i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved Period&#39;</span><span class="p">,</span> <span class="n">T_i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="c1">## take out later</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_STM</span><span class="p">()</span>
        <span class="n">detM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Monodromy Matrix Determinant&#39;</span><span class="p">,</span> <span class="n">detM</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">s_i</span><span class="p">,</span> <span class="n">T_i</span><span class="p">,</span> <span class="n">DFX_ip1</span></div>

        <span class="c1"># return state_solutions, per_solutions, error_list</span>

<div class="viewcode-block" id="Simulation.multi_shooter"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.multi_shooter">[docs]</a>    <span class="k">def</span> <span class="nf">multi_shooter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            multi_shooter:</span>
<span class="sd">                multiple shooting algorithm to compute strictly periodic orbits</span>
<span class="sd">                with epoch continuity</span>


<span class="sd">                ** uses dyn_sys_tools.multi_shooter_update_state()</span>
<span class="sd">                ** Currently only takes N = 4 patch points</span>

<span class="sd">                ** Current update equation reaches solution where the first patch point</span>
<span class="sd">                begins on the x axis.. [x0, 0, 0, vx, vy, v0]. </span>
<span class="sd">                So be smart while picking your initial guess :) </span>

<span class="sd">                Args:</span>
<span class="sd">                    s0 (1x6 array): initial guess of periodic orbit - must be close</span>
<span class="sd">                    T0 (float): initial guess of orbit periodi</span>
<span class="sd">                    N (int): # of patch points</span>
<span class="sd">                    tol (float): tol (flt): tolerance to satisfy for norm of the constrain </span>
<span class="sd">                            function, ||F(X)||</span>

<span class="sd">                Returns:</span>
<span class="sd">                    S (1x6 array): solved periodic IC </span>
<span class="sd">                    T (float): sovled period of orbit</span>
<span class="sd">                    epoch (float): solved initial epoch, must be used in ER3BP, BCR4BP</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create initial set of states</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sat</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propogate</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>

        <span class="n">patches</span><span class="p">,</span> <span class="n">TOFs</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">init_patches</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">e_old</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">e_new</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_scs</span><span class="p">()</span>

        <span class="n">epochs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TOFs</span><span class="p">)):</span>
            <span class="n">epochs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">TOFs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>

        <span class="k">while</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            
            <span class="n">X_ip1</span><span class="p">,</span> <span class="n">FX_i</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">multi_shooter_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">TOFs</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">)</span>
            
            <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X_ip1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="p">)],</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">epochs</span> <span class="o">=</span> <span class="n">X_ip1</span><span class="p">[</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="n">N</span><span class="p">]</span>
            <span class="n">TOFs</span> <span class="o">=</span> <span class="n">X_ip1</span><span class="p">[</span><span class="o">-</span><span class="n">N</span><span class="p">:]</span>

            <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">FX_i</span><span class="p">)</span>

            <span class="c1">### Optional error computation method</span>
            <span class="c1"># eps = np.abs(e_new - e_old)</span>
            <span class="c1"># e_old = e_new</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eps</span>

        <span class="n">S</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">TOFs</span><span class="p">)</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="n">epochs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved State&#39;</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved Period&#39;</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved Epoch&#39;</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span> <span class="o">==</span> <span class="s1">&#39;ER3BP&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solved eccentricity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">char_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">][</span><span class="s1">&#39;e&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">eps</span></div>

<div class="viewcode-block" id="Simulation.read_fam_csv"><a class="viewcode-back" href="../../simulation.html#pyraa.simulation.Simulation.read_fam_csv">[docs]</a>    <span class="k">def</span> <span class="nf">read_fam_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            read_fam_csv:</span>
<span class="sd">                reads csv file and imports IC and periods</span>
<span class="sd">                into numpy arrays</span>

<span class="sd">                ** looks in HIDE/families/</span>
<span class="sd">                Args:</span>
<span class="sd">                    path (str): csv file name</span>

<span class="sd">                Returns:</span>
<span class="sd">                    states (Nx6 array): family IC</span>
<span class="sd">                    periods (N array): family periods corresponding to IC</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;families/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">states</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">7</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">periods</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">7</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">states</span><span class="p">,</span> <span class="n">periods</span></div>

    <span class="k">def</span> <span class="nf">filter_JC</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>

        <span class="c1">#self.calc_JC() # If you want to scan all JCs -- currently just looks</span>
        <span class="c1"># at the last value to see if it is different</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtering JCs&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">Ninit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">(</span><span class="n">Ninit</span><span class="p">)</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">JC_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_JC_func</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
            <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                
            <span class="n">JC0</span> <span class="o">=</span> <span class="n">JC_func</span><span class="p">(</span><span class="n">taus</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s0</span><span class="p">)</span>
            <span class="n">JCf</span> <span class="o">=</span> <span class="n">JC_func</span><span class="p">(</span><span class="n">taus</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

            <span class="n">resid_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">JCf</span> <span class="o">-</span> <span class="n">JC0</span><span class="p">)</span><span class="o">/</span><span class="n">JC0</span>
            <span class="k">if</span> <span class="n">resid_norm</span> <span class="o">&gt;</span> <span class="mf">5e-4</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">Nfinal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>
        <span class="n">sc_rm</span> <span class="o">=</span> <span class="n">Ninit</span><span class="o">-</span><span class="n">Nfinal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_rm</span> <span class="o">=</span> <span class="n">sc_rm</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;JCs filtered: </span><span class="si">{}</span><span class="s1"> sc removed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sc_rm</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compuation time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">save_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">taus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
        <span class="n">FTLEs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">STMs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">Events</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">JCs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">char_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">][</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span> 
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">char_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamics</span><span class="p">][</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> 
        <span class="n">N_sc</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">)</span>
        <span class="n">M_eval</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_taus</span><span class="p">())</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_HiDE_Mu</span><span class="si">{}</span><span class="s2">_e</span><span class="si">{}</span><span class="s2">_JC</span><span class="si">{:4.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">JC</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;save_sim/</span><span class="si">{}</span><span class="s1">.hdf5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="c1">### Handles multiple saved files for a given day, run</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">exists</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">i_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">temp_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">file_name</span><span class="p">,</span> <span class="n">i_str</span><span class="p">])</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="s1">&#39;save_sim/</span><span class="si">{}</span><span class="s1">.hdf5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_name</span><span class="p">)</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">temp_path</span>
            
        <span class="c1"># Open file </span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>

        <span class="c1"># Add general metadata</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;N Ob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_sc</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;M Eval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_eval</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;JC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">JC</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;LMR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LMR</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;tau_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;sc_rm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_rm</span>

        <span class="k">if</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">states_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;States&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">states</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                <span class="n">states_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">states</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved states..&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">taus</span><span class="p">:</span>
            <span class="n">taus_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Taus&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">taus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_taus</span><span class="p">()</span>
                <span class="n">taus_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">taus</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved taus..&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">FTLEs</span><span class="p">:</span>
            <span class="n">FTLE_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;FTLEs&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">FTLEs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_FTLEs</span><span class="p">()</span>
                <span class="n">FTLE_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">FTLEs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved FTLEs..&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">STMs</span><span class="p">:</span>
            <span class="n">STMs_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;STMs&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">STMs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_STMs</span><span class="p">()</span>
                <span class="n">STMs_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">taus</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved STMs..&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">Events</span><span class="p">:</span>
            <span class="n">Events_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">)</span>
            <span class="n">Etaus_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Event Taus&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">events</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_events</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">etaus</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_etaus</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">etaus</span><span class="p">)</span>
                <span class="n">Events_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">events</span><span class="p">)</span>
                <span class="n">Etaus_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">etaus</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved Events..&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">JCs</span><span class="p">:</span>
            <span class="n">JCs_grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;JCs&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">JCs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_JCs</span><span class="p">()</span>
                <span class="n">JCs_grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">JCs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved JCs...&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation saved in HDF5 format to...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span></div>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Drew Langford.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>